<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Asistencia</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='normalize.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style_asistencia.css') }}" />
</head>

<body>
  <header>
    <nav class="top-nav">
      <div class="nav-left">
        <img src="{{ url_for('static', filename='imgs/logo.png') }}" alt="Logo">
      </div>
      <div class="nav-right">
        <button onclick="window.location.href='/logout';">Cerrar sesi√≥n</button>
      </div>
    </nav>
  </header>
<!-- CONTENEDOR PRINCIPAL -->
<div class="Div-Principal">

<!-- aqui esta dentro el contenedor de la foto para poder editarla correctamente -->
<div class="form-container">
  <div class="video-container">
<video id="video" width="320" height="240" autoplay></video>
  <canvas id="canvas" style="display: none;"></canvas>
  </div>
  <button id="abrirCamaraBtn">Abrir C√°mara</button>
    <button id="tomarFotoBtn" style="display:none;">Tomar Foto</button>
    <button id="cerrarCamaraBtn" style="display:none;">Cerrar C√°mara</button>
</div>
  

  <p id="resultado"></p>

  <!-- Inputs ocultos para ubicaci√≥n -->
   <!-- Escribe aqu√≠ tu comentario -->

  <input type="hidden" id="latitud" name="latitud">
  <input type="hidden" id="longitud" name="longitud">
</div>



 
</body>
<script>
  const abrirCamaraBtn = document.getElementById('abrirCamaraBtn');
  const video = document.getElementById('video');
  const tomarFotoBtn = document.getElementById('tomarFoto');
  const canvas = document.getElementById('canvas');
  const fotoInput = document.getElementById('fotoInput');
  let stream;

  abrirCamaraBtn.addEventListener('click', async function () {
    try {
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "user" } // üîÑ Forzar c√°mara frontal
      });
      video.srcObject = stream;
      video.style.display = 'block';
      tomarFotoBtn.style.display = 'inline-block';
      abrirCamaraBtn.style.display = 'none';
    } catch (err) {
      alert("No se pudo acceder a la c√°mara: " + err.message);
    }
  });

  tomarFotoBtn.addEventListener('click', () => {
    const ctx = canvas.getContext('2d');
    const width = 320;
    const height = 240;
    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(video, 0, 0, width, height);

    const dataURL = canvas.toDataURL('image/jpeg', 0.6);
    fotoInput.value = dataURL;

    // üëÅÔ∏è Mostrar previsualizaci√≥n (opcional pero √∫til para pruebas)
    const preview = document.getElementById('previewImg');
    if (preview) {
      preview.src = dataURL;
    } else {
      const imgPreview = document.createElement('img');
      imgPreview.id = 'previewImg';
      imgPreview.src = dataURL;
      imgPreview.style.marginTop = '10px';
      imgPreview.style.maxWidth = '100%';
      document.querySelector('.form-container').appendChild(imgPreview);
    }

    alert("üì∏ Foto capturada. Ahora env√≠a el formulario.");

    // Detener c√°mara
    stream.getTracks().forEach(track => track.stop());
    video.style.display = 'none';
    tomarFotoBtn.style.display = 'none';
    abrirCamaraBtn.style.display = 'inline-block';
  });
</script>

</html>